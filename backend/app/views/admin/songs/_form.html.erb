<%= form_with model: @song, url: @song.new_record? ? admin_songs_path : admin_song_path(@song), method: @song.new_record? ? :post : :patch, multipart: true do |f| %>
  <label>Title</label>
  <%= f.text_field :title, required: true %>
  
  <label>Owner</label>
  <%= f.text_field :owner, required: true %>
  
  <label>Artists (comma-separated)</label>
  <%= f.text_field :artists, value: @song.artists.join(', ') %>
  
  <label>Genres (comma-separated)</label>
  <%= f.text_field :genres, value: @song.genres.join(', ') %>
  
  <label>Colors (3 hex codes, comma-separated, e.g., #FF5733, #33FF57, #3357FF)</label>
  <%= f.text_field :colors, value: @song.colors&.join(', '), placeholder: '#FF5733, #33FF57, #3357FF' %>
  
  <label>Album Art (URL or upload)</label>
  <%= f.text_field :album_art, placeholder: 'Or upload below' %>
  <%= f.file_field :album_art_file, accept: 'image/*' %>
  
  <label>Video Preview (URL or upload)</label>
  <%= f.text_field :video_preview, placeholder: 'Or upload below' %>
  <%= f.file_field :video_preview_file, accept: 'video/*' %>
  
  <label>Audio Preview (URL or upload)</label>
  <%= f.text_field :audio_preview, placeholder: 'Or upload below' %>
  <%= f.file_field :audio_preview_file, accept: 'audio/*' %>
  
  <%= f.submit @song.new_record? ? 'Create Song' : 'Update Song' %>
  <%= link_to 'Cancel', admin_songs_path, class: 'btn' %>
<% end %>

<script>
  document.querySelector('form').addEventListener('submit', function(e) {
    const artistsField = document.querySelector('input[name="song[artists]"]');
    const genresField = document.querySelector('input[name="song[genres]"]');
    const colorsField = document.querySelector('input[name="song[colors]"]');
    
    if (artistsField.value) {
      artistsField.value = JSON.stringify(artistsField.value.split(',').map(s => s.trim()));
    }
    if (genresField.value) {
      genresField.value = JSON.stringify(genresField.value.split(',').map(s => s.trim()));
    }
    if (colorsField.value) {
      colorsField.value = JSON.stringify(colorsField.value.split(',').map(s => s.trim()));
    }
  });
</script>